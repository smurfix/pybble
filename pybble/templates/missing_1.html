{% extends 'layout.html' %}

{% if can_read(d_comment) or can_add(d_comment) %}
{%- set styles = ['SubTree.css'] + styles|default([]) -%}
{%- set scripts = ['jQuery.SubTree.js'] + scripts|default([]) -%}
{% endif %}
{% block add_header %}
{% if obj.has_children(d_comment) %}
<script type="text/javascript">
	$(document).ready( function() {
		$('div.comments ul li').subTree({ script: '/snippet/{{d_comment}}', discr: '{{d_comment}}', cscript: '/snippet/hierarchy'});
	});
</script>
{% endif %}
{% endblock %}

  {% block body %}
  {% if can_add(d_comment) %}
  <div class="new_comment"><a href="{{ url_for("pybble.views.new_oid",oid=obj.oid(),discr=d_comment) }}">{% if obj.discriminator == d_comment %}antworten{% else %}Diese Seite kommentieren{% endif %}</a></div>
  {% endif %}

<div class="subpage">
{{ subpage(obj) }}
</div>

  {% if can_read(d_comment) %}
    {% set nc = obj.has_children(d_comment) %}
  {% else %}
    {% set nc = -1 %}
  {% endif %}
  {% if nc > 0 or can_add(d_comment) %}
  <div class="comments">
    <ul class="SubTree">
	  <li class="t_Comments {% if nc>0 %}collapsed{% else %}terminal{% endif %}" rel="{{ obj.oid() }}">
		<span class="image"></span>
		<span href="#nogo" class="contents">
			{%- if nc <= 0 -%}
				keine Kommentare
			{%- elif nc == 1 -%}
				ein Kommentar
			{%- else -%}
				{{ nc }} Kommentare
			{%- endif -%}
		</span>
	  </li>
	</ul>
  </div>
  {% endif %}
{% endblock %}
