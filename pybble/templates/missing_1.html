{% extends 'layout.html' %}

{% if can_read(d_comment) or can_add(d_comment) %}
{%- set styles = ['SubTree.css'] + styles|default([]) -%}
{%- set scripts = ['jQuery.SubTree.js'] + scripts|default([]) -%}
{% endif %}
{% block add_header %}
{% if obj.has_children(d_comment) %}
<script type="text/javascript">
	$(document).ready( function() {
		$('div.comments ul li').subTree({ script: '/snippet/{{d_comment}}', discr: '{{d_comment}}', cscript: '/snippet/hierarchy'});
	});
</script>
{% endif %}
{% endblock %}

  {% block body %}
  <div class="new_comment">
  {% if obj != SITE and obj.parent%}
  zu <a href="{{ url_for("pybble.views.view_oid",oid=obj.parent.oid()) }}">{{ subline(obj.parent) }}</a>
  {% endif %}
  {% if can_add(d_comment) %}
  {% if obj != SITE and obj.parent %}| {% endif %}
  <a href="{{ url_for("pybble.views.new_oid",oid=obj.oid(),discr=d_comment) }}">{% if obj.discriminator == d_comment %}antworten{% else %}Diese Seite kommentieren{% endif %}</a>
  {%- endif -%}
  </div>
  {% if can_add(d_bindata) %}
  <div class="new_bindata"><a href="{{ url_for("pybble.views.new_oid",oid=obj.oid(),discr=d_bindata) }}">Datei anh√§ngen</a></div>
  {% endif %}

<div class="subpage">
{{ subpage(obj) }}
</div>

  {% if can_read(d_comment) %}
    {% set nc = obj.has_children(d_comment) %}
  {% else %}
    {% set nc = -1 %}
  {% endif %}
  {% if nc > 0 or can_add(d_comment) %}
  <div class="comments">
    <ul class="SubTree">
      {% if not details %}{% set details=() %}{% endif %}
      {% if not aux %}{% set aux=() %}{% endif %}
	  <li class="t_Comment {% if aux %}expanded{% elif nc>0 %}collapsed{% else %}terminal{% endif %}" rel="{{ obj.oid() }}">
		<span class="image"></span>
		<span href="#nogo" class="contents">
		  {%- if nc <= 0 -%}
			Dieser Beitrag wurde noch nicht kommentiert.
		  {%- elif nc == 1 -%}
			Dieser Beitrag wurde einmal kommentiert.
		  {%- else -%}
			Dieser Beitrag wurde {{ nc }}mal kommentiert.
		  {%- endif -%}
		</span>
		{% if aux %}
		  <ul>
			{% for o in obj.all_children(d_comment) %}
			  {{ subpage(o,tm_snippet) }}
			{% endfor %}
		  </ul>
		{% endif %}
	  </li>
	</ul>
  </div>
  {% endif %}
{% endblock %}
